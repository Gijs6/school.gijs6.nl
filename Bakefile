#!/bin/bash

serve() {
  .venv/bin/python binder.py serve --dev
}

build() {
  .venv/bin/python binder.py build
}

deploy() {
  build
  npx prettier --write --ignore-path /dev/null "build/**/*.{css,js,xml,html}"
  lift deploy && echo "Deployed successfully to https://$(yq .name Liftfile)"
}

publish() {
  if ! git diff-index --quiet HEAD --; then
    git stash push -m "bake-publish"
    STASHED=1
  else
    STASHED=0
  fi

  format
  git commit -a -m "Format repo" || true

  if [ "$STASHED" -eq 1 ]; then
    git stash pop
  fi

  git push & deploy & wait
}

format() {
  ruff format .
  npx prettier --write "**/*.{css,js,json,xml}"
  djlint . --reformat
}
